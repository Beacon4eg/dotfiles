#!/bin/bash

# Write you devserver here
DEVSERVER="devbig021.lla2.facebook.com"

SCRIPT=`basename $0`
HOST=${1:-$DEVSERVER}
PORT=${2:-5893}

function error() {
  local code=$1
  local message=$2

  echo -e $message >> /dev/stderr
  exit $code
}

case "$HOST" in
  "-h"|"--help"|"")
    error 1 "Usage: $SCRIPT [port]";;
  *)
    echo -e "VNC: Connecting to $HOST on port $PORT...\n";;
esac

lsof -i tcp:${PORT} | grep ssh | awk '{print $2}' | xargs kill &> /dev/null
ssh -N -f -L $PORT:127.0.0.1:$PORT $DEVSERVER &> /dev/null
sleep 5
open vnc://127.0.0.1:$PORT/
